<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Booking Confirmed</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="p-4">
  <div class="container">
    <h1 class="mb-4">Booking Confirmed!</h1>
    <div id="details" class="card p-4">
      <p>Loading your confirmation...</p>
    </div>
    <a href="index.html" class="btn btn-link mt-3">&larr; Back to Search</a>
  </div>

  <script>
    (async () => {
      // 1) Get booking ID from query string
      const params = new URLSearchParams(window.location.search);
      const bookingId = params.get('booking_id');
      if (!bookingId) {
        document.getElementById('details').innerHTML = '<div class="alert alert-warning">No booking ID provided.</div>';
        return;
      }

      try {
        // 2) Fetch booking details
        const resBk = await fetch('/api/bookings/' + bookingId);
        if (!resBk.ok) throw new Error('Booking not found');
        const bk = await resBk.json();

        // 3) Fetch listing name
        const resList = await fetch('/api/listing/' + bk.listing_id);
        const list = resList.ok ? await resList.json() : { name: 'Listing ' + bk.listing_id };

        // 4) Render confirmation
        document.getElementById('details').innerHTML = `
          <h2 class="h5">${list.name}</h2>
          <ul class="list-unstyled mt-3">
            <li><strong>Guest:</strong> ${bk.guest_name}</li>
            <li><strong>From:</strong> ${new Date(bk.start_date).toDateString()}</li>
            <li><strong>To:</strong> ${new Date(bk.end_date).toDateString()}</li>
            <li><strong>Contact:</strong> ${bk.contact}</li>
          </ul>
        `;
      } catch (err) {
        console.error(err);
        document.getElementById('details').innerHTML = `<div class="alert alert-danger">Error loading confirmation: ${err.message}</div>`;
      }
    })();
  </script>
</body>
</html>
